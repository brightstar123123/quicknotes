<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cloud Notepad</title>

<link rel="stylesheet" href="style.css">
</head>


<body>

    <div class="app">

  <header class="header">
    <div id="userPanel" class="user-panel" style="display:none;">
      <img id="avatar" class="avatar">
      <div id="username"></div>
    </div>

    <div class="auth-buttons">
      <!-- buttons are injected by JS -->
    </div>
  </header>

  <main class="card">
    <h2>Cloud Notepad</h2>

    <textarea id="note" placeholder="Start typing..."></textarea>

    <div class="status-bar">
      <span id="status"></span>
    </div>
  </main>

</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

import {
  getAuth,
  signInWithPopup,
  GoogleAuthProvider,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCM3dF4lyfDdOgGzEdpbiVygQjiEM7YbyE",
  authDomain: "quicknotes-77a6d.firebaseapp.com",
  projectId: "quicknotes-77a6d",
  storageBucket: "quicknotes-77a6d.firebasestorage.app",
  messagingSenderId: "352061113898",
  appId: "1:352061113898:web:9b515f00610124f8662553",
  measurementId: "G-34FYTLCP7D"
};


const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const provider = new GoogleAuthProvider();

const noteEl = document.getElementById("note");
const status = document.getElementById("status");

/* Login button */
const loginBtn = document.createElement("button");
loginBtn.textContent = "Sign in";
document.body.prepend(loginBtn);

const logoutBtn = document.createElement("button");
logoutBtn.textContent = "Sign out";
logoutBtn.style.display = "none";
document.body.prepend(logoutBtn);

/* Auth flow */
loginBtn.onclick = () => signInWithPopup(auth, provider);
logoutBtn.onclick = () => signOut(auth);

const userPanel = document.getElementById("userPanel");
const avatar = document.getElementById("avatar");
const username = document.getElementById("username");

onAuthStateChanged(auth, user => {
  if (!user) {
    noteEl.disabled = true;
    status.textContent = "Please sign in";

    userPanel.style.display = "none";
    loginBtn.style.display = "inline";
    logoutBtn.style.display = "none";
    return;
  }

  /* Show user info */
  userPanel.style.display = "block";
  avatar.src = user.photoURL;
  username.textContent = `${user.displayName} (${user.email})`;

  loginBtn.style.display = "none";
  logoutBtn.style.display = "inline";
  noteEl.disabled = false;

  const noteRef = doc(db, "notes", user.uid);

  onSnapshot(noteRef, snap => {
    if (snap.exists()) {
      const cloudText = snap.data().text || "";
      if (noteEl.value !== cloudText) {
        noteEl.value = cloudText;
      }
    }
  });

  noteEl.addEventListener("input", async () => {
    await setDoc(noteRef, {
      text: noteEl.value,
      updated: new Date().toISOString()
    });

    status.textContent = "Saved âœ”";
  });
});

</script>


</body>
</html>
