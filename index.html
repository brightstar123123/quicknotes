<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cloud Notepad</title>

<link rel="stylesheet" href="style.css">
</head>


<body>

<div id="loginView" class="login-screen">

  <div class="login-card">
    <h1>Cloud Notepad</h1>
    <p>Secure synced notes across all devices</p>

    <button id="googleLogin" class="login-btn google">
      <img src="https://www.svgrepo.com/show/475656/google-color.svg">
      Sign in with Google
    </button>

    <button id="microsoftLogin" class="login-btn microsoft">
      <img src="https://www.svgrepo.com/show/448239/microsoft.svg">
      Sign in with Microsoft
    </button>

  </div>

</div>

<div id="appView" class="app" style="display:none;">

  <header class="header">
    <div id="userPanel" class="user-panel">
      <img id="avatar" class="avatar">
      <span id="username"></span>
    </div>

    <div>
      <button id="themeToggle">ğŸŒ™</button>
      <button id="logoutBtn">Sign out</button>
    </div>
  </header>

  <main class="card">
    <textarea id="note" placeholder="Start typing..."></textarea>
    <div class="status-bar" id="status"></div>
  </main>

</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getFirestore,
  doc,
  setDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

import {
  getAuth,
  signInWithPopup,
  GoogleAuthProvider,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCM3dF4lyfDdOgGzEdpbiVygQjiEM7YbyE",
  authDomain: "quicknotes-77a6d.firebaseapp.com",
  projectId: "quicknotes-77a6d",
  storageBucket: "quicknotes-77a6d.firebasestorage.app",
  messagingSenderId: "352061113898",
  appId: "1:352061113898:web:9b515f00610124f8662553",
  measurementId: "G-34FYTLCP7D"
};

import { OAuthProvider } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const googleProvider = new GoogleAuthProvider();
const microsoftProvider = new OAuthProvider("microsoft.com");


const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const provider = new GoogleAuthProvider();

const noteEl = document.getElementById("note");
const status = document.getElementById("status");

/* Login button */
document.getElementById("googleLogin").onclick =
  () => signInWithPopup(auth, googleProvider);

document.getElementById("microsoftLogin").onclick =
  () => signInWithPopup(auth, microsoftProvider);

/*
const logoutBtn = document.createElement("button");
logoutBtn.textContent = "Sign out";
logoutBtn.style.display = "none";
document.body.prepend(logoutBtn);
*/

document.getElementById("logoutBtn").onclick =
  () => signOut(auth);

/* Auth flow */
loginBtn.onclick = () => signInWithPopup(auth, provider);
logoutBtn.onclick = () => signOut(auth);

const userPanel = document.getElementById("userPanel");
const avatar = document.getElementById("avatar");
const username = document.getElementById("username");

const loginView = document.getElementById("loginView");
const appView = document.getElementById("appView");

onAuthStateChanged(auth, user => {

  if (!user) {
    loginView.style.display = "flex";
    appView.style.display = "none";
    return;
  }

  loginView.style.display = "none";
  appView.style.display = "block";

  avatar.src = user.photoURL;
  username.textContent = user.displayName;

  const noteRef = doc(db, "notes", user.uid);

  onSnapshot(noteRef, snap => {
    if (snap.exists()) {
      noteEl.value = snap.data().text || "";
    }
  });

  noteEl.addEventListener("input", async () => {
    await setDoc(noteRef, {
      text: noteEl.value,
      updated: new Date().toISOString()
    });

    status.textContent = "Saved âœ”";
  });
});


const toggle = document.getElementById("themeToggle");

// load saved theme
const savedTheme = localStorage.getItem("theme");
if (savedTheme === "dark") {
  document.body.classList.add("dark");
  toggle.textContent = "â˜€ï¸";
}

toggle.onclick = () => {
  document.body.classList.toggle("dark");

  const isDark = document.body.classList.contains("dark");

  toggle.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
  localStorage.setItem("theme", isDark ? "dark" : "light");
};
</script>


</body>
</html>
